pipeline {
    agent none

    parameters {
        choice(name: 'ENV', choices: ['dev', 'prod', 'stage'], description: 'The node label to run the pipeline on')
        choice(name: 'NODE', choices: ['agent1', 'built-in-node'], description: 'The node label to run the pipeline on')
    }



    stages {
        stage('Deploy'){

            agent {
                node {
                    label params.NODE
                }
            }

            environment {
                ENV = params.ENV
                NODE = params.NODE
                TAG = sh(returnStdout: true, script: "git rev-parse --short=10 HEAD").trim()
            }

          
            
            steps {
                echo "Deploying: $TAG"
                echo "Deploying to: $NODE"
                echo "ENV: $ENV"
                

                sh "docker run -d --name esign-web-$ENV-$TAG -p 4008:4008  --env-file .env.$ENV annguyen137/esign-web:$TAG"


            }
        }
    }
}